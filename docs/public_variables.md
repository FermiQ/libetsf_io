# `public_variables.f90` - Public Variables and Constants for ETSF I/O

## Overview

This file defines public parameters and constants that are used throughout the ETSF I/O low-level library (`etsf_io_low_level` module and related files). These include identifiers for data types, error handling codes, limits, and other global settings that ensure consistency and provide a standardized way to refer to common values. This file is typically included within the `etsf_io_low_level` module.

The definitions in this file rely on the `netcdf` module for some base values (like `NF90_INT`, `NF90_GLOBAL`, etc.).

## Key Components

This file does not define standalone functions or modules in the traditional sense. Instead, it declares `PARAMETER` constants and `TYPE` definitions that become part of the module that includes it (i.e., `etsf_io_low_level`).

## Important Variables/Constants

### ETSF Data Type Identifiers
These parameters map ETSF I/O's internal type identifiers to NetCDF type identifiers.
-   **`ETSF_IO_LOW_INTEGER` (`INTEGER, PARAMETER`):** Identifier for the integer data type. (Value: `NF90_INT`)
-   **`ETSF_IO_LOW_REAL` (`INTEGER, PARAMETER`):** Identifier for the real (single precision) data type. (Value: `NF90_FLOAT`)
-   **`ETSF_IO_LOW_DOUBLE` (`INTEGER, PARAMETER`):** Identifier for the double precision real data type. (Value: `NF90_DOUBLE`)
-   **`ETSF_IO_LOW_CHARACTER` (`INTEGER, PARAMETER`):** Identifier for the character data type. (Value: `NF90_CHAR`)
-   *Note: A specific `ETSF_IO_LOW_LOGICAL` is not explicitly defined here using NetCDF types; logical data is typically handled as integers or characters by convention in NetCDF.*

### Global Attribute Identifier
-   **`etsf_io_low_global_att` (`INTEGER, PARAMETER`):** Special identifier used to signify global attributes in NetCDF calls (e.g., when reading or writing attributes not associated with a specific variable). (Value: `NF90_GLOBAL`)

### Error Handling Constants (Error Modes)
These parameters define categories for the type of operation being performed when an error occurs.
-   **`ERROR_MODE_DEF` (`INTEGER, PARAMETER`):** Error occurred during a "define" operation (e.g., defining a variable or dimension). (Value: 1)
-   **`ERROR_MODE_GET` (`INTEGER, PARAMETER`):** Error occurred during a "get" or "read" operation. (Value: 2)
-   **`ERROR_MODE_IO` (`INTEGER, PARAMETER`):** General input/output error not covered by more specific modes (e.g., opening or closing a file). (Value: 3)
-   **`ERROR_MODE_INQ` (`INTEGER, PARAMETER`):** Error occurred during an "inquire" operation (e.g., querying metadata). (Value: 4)
-   **`ERROR_MODE_PUT` (`INTEGER, PARAMETER`):** Error occurred during a "put" or "write" operation. (Value: 5)
-   **`ERROR_MODE_SPEC` (`INTEGER, PARAMETER`):** Error related to adherence to ETSF specifications (e.g., wrong type, wrong dimension, mismatched value). (Value: 6)
-   **`ERROR_MODE_COPY` (`INTEGER, PARAMETER`):** Error occurred during a copy operation (e.g., `nf90_copy_att`). (Value: 7)

### Error Handling Constants (Error Target Types)
These parameters define the type of NetCDF entity or operation that was the target when an error occurred.
-   **`ERROR_TYPE_ATT` (`INTEGER, PARAMETER`):** The error relates to an attribute. (Value: 1)
-   **`ERROR_TYPE_DID` (`INTEGER, PARAMETER`):** The error relates to a dimension ID. (Value: 2)
-   **`ERROR_TYPE_DIM` (`INTEGER, PARAMETER`):** The error relates to a dimension definition or value. (Value: 3)
-   **`ERROR_TYPE_END` (`INTEGER, PARAMETER`):** The error relates to ending define mode (`nf90_enddef`). (Value: 4)
-   **`ERROR_TYPE_DEF` (`INTEGER, PARAMETER`):** The error relates to entering define mode (`nf90_redef`). (Value: 5)
-   **`ERROR_TYPE_OCR` (`INTEGER, PARAMETER`):** The error relates to creating a file (OCR likely stands for Open CReate). (Value: 6)
-   **`ERROR_TYPE_ORD` (`INTEGER, PARAMETER`):** The error relates to opening a file for reading (ORD likely for Open ReaD). (Value: 7)
-   **`ERROR_TYPE_OWR` (`INTEGER, PARAMETER`):** The error relates to opening a file for writing/modification (OWR for Open WRite). (Value: 8)
-   **`ERROR_TYPE_VAR` (`INTEGER, PARAMETER`):** The error relates to a variable definition or data. (Value: 9)
-   **`ERROR_TYPE_VID` (`INTEGER, PARAMETER`):** The error relates to a variable ID. (Value: 10)
-   **`ERROR_TYPE_CLO` (`INTEGER, PARAMETER`):** The error relates to closing a file. (Value: 11)
-   **`ERROR_TYPE_ARG` (`INTEGER, PARAMETER`):** The error relates to a routine argument being invalid. (Value: 12)

### Error Message Length
-   **`etsf_io_low_error_len` (`INTEGER, PARAMETER`):** Defines the maximum length for formatted error messages generated by `etsf_io_low_error_to_str`. (Value: 4096)

### Derived Type Definitions (Public Structures)

-   **`etsf_io_low_error` (`TYPE`):**
    -   `backtrace(100)` (`CHARACTER(LEN=80)`): Array to store the call stack (sequence of routines called).
    -   `backtraceId` (`INTEGER`): Current depth of the backtrace (number of entries in `backtrace`). Initialized to 0.
    -   `access_mode_id` (`INTEGER`): Identifier for the access mode (from `ERROR_MODE_...` constants) when the error occurred.
    -   `access_mode_str` (`CHARACTER(LEN=80)`): String representation of the access mode (filled by error setting routines).
    -   `target_type_id` (`INTEGER`): Identifier for the target type (from `ERROR_TYPE_...` constants) of the operation when the error occurred.
    -   `target_type_str` (`CHARACTER(LEN=80)`): String representation of the target type (filled by error setting routines).
    -   `target_id` (`INTEGER`): Numerical ID of the target (e.g., variable ID, dimension ID) if applicable.
    -   `target_name` (`CHARACTER(LEN=80)`): Name of the target (e.g., variable name, dimension name) if applicable.
    -   `error_id` (`INTEGER`): Error code, often the status returned directly from a NetCDF library call (e.g., `nf90_noerr`).
    -   `error_message` (`CHARACTER(LEN=256)`): Descriptive error message, potentially from `nf90_strerror` or custom.
    -   **Overview**: This structure is fundamental for detailed error reporting throughout the `etsf_io_low_level` library. It's passed as an optional argument to most routines to capture comprehensive information if an operation fails.

-   **`etsf_io_low_var_integer` (`TYPE`):**
    -   `data1D` (`INTEGER, POINTER :: data1D(:) => null()`)
    -   `data2D` (`INTEGER, POINTER :: data2D(:,:) => null()`)
    -   `data3D` (`INTEGER, POINTER :: data3D(:,:,:) => null()`)
    -   `data4D` (`INTEGER, POINTER :: data4D(:,:,:,:) => null()`)
    -   `data5D` (`INTEGER, POINTER :: data5D(:,:,:,:,:) => null()`)
    -   `data6D` (`INTEGER, POINTER :: data6D(:,:,:,:,:,:) => null()`)
    -   `data7D` (`INTEGER, POINTER :: data7D(:,:,:,:,:,:,:) => null()`)
    -   **Overview**: A derived type designed to handle integer arrays of undefined rank at compile time (up to 7 dimensions). It uses a set of pointers, only one of which is expected to be associated at any given time, to point to the actual integer data. This allows generic routines to work with integer arrays of varying dimensionality.

-   **`etsf_io_low_var_double` (`TYPE`):**
    -   `data1D` (`DOUBLE PRECISION, POINTER :: data1D(:) => null()`)
    -   `data2D` (`DOUBLE PRECISION, POINTER :: data2D(:,:) => null()`)
    -   `data3D` (`DOUBLE PRECISION, POINTER :: data3D(:,:,:) => null()`)
    -   `data4D` (`DOUBLE PRECISION, POINTER :: data4D(:,:,:,:) => null()`)
    -   `data5D` (`DOUBLE PRECISION, POINTER :: data5D(:,:,:,:,:) => null()`)
    -   `data6D` (`DOUBLE PRECISION, POINTER :: data6D(:,:,:,:,:,:) => null()`)
    -   `data7D` (`DOUBLE PRECISION, POINTER :: data7D(:,:,:,:,:,:,:) => null()`)
    -   **Overview**: Similar to `etsf_io_low_var_integer`, but for `DOUBLE PRECISION` (real*8) arrays.

-   **`etsf_io_low_var_infos` (`TYPE`):**
    -   `name` (`CHARACTER(LEN=80)`): Name of the NetCDF variable.
    -   `nctype` (`INTEGER`): NetCDF data type of the variable (e.g., `NF90_INT`, `NF90_DOUBLE`).
    -   `ncid` (`INTEGER`): NetCDF ID of the variable.
    -   `ncshape` (`INTEGER`): Number of dimensions of the variable (rank).
    -   `ncdims(1:16)` (`INTEGER`): Array storing the size of each dimension. The source code indicates up to 16, though NetCDF standard is often 7 for `NF90_MAX_VAR_DIMS`.
    -   `ncdimnames(:)` (`CHARACTER(LEN=80), POINTER => null()`): Pointer to an array of strings holding the names of the dimensions. Allocated when dimension names are requested.
    -   `ncattnames(:)` (`CHARACTER(LEN=80), POINTER => null()`): Pointer to an array of strings holding the names of attributes associated with the variable. Allocated when attribute names are requested.
    -   **Overview**: This structure is used to store comprehensive metadata about a variable within a NetCDF file, such as its name, type, ID, shape, dimension sizes, and optionally dimension and attribute names.

## Usage Examples

These constants and types are primarily used internally by the subroutines within the `etsf_io_low_level` module. For instance, when `etsf_io_low_read_var` is called, it might use `ETSF_IO_LOW_INTEGER` to check the type of the variable being read, and if an error occurs, it would populate an `etsf_io_low_error` structure using constants like `ERROR_MODE_GET` and `ERROR_TYPE_VAR`.

```fortran
USE etsf_io_low_level ! Assuming this module makes these parameters and types public

SUBROUTINE example_routine_using_public_vars(ncid_file, var_name_to_check, lstat_check, error_details)
    IMPLICIT NONE
    INTEGER, INTENT(IN) :: ncid_file
    CHARACTER(LEN=*), INTENT(IN) :: var_name_to_check
    LOGICAL, INTENT(OUT) :: lstat_check
    TYPE(etsf_io_low_error), INTENT(OUT) :: error_details

    TYPE(etsf_io_low_var_infos) :: variable_info
    LOGICAL :: internal_lstat

    ! Try to read variable information
    CALL etsf_io_low_read_var_infos(ncid_file, var_name_to_check, variable_info, internal_lstat, &
                                  & error_data=error_details)

    IF (.NOT. internal_lstat) THEN
        lstat_check = .FALSE.
        ! The error_details structure is already populated by etsf_io_low_read_var_infos
        RETURN
    END IF

    ! Check if the variable is of type ETSF_IO_LOW_DOUBLE
    IF (variable_info%nctype == ETSF_IO_LOW_DOUBLE) THEN
        WRITE(*,*) "Variable '", TRIM(var_name_to_check), "' is double precision."
    ELSE
        WRITE(*,*) "Variable '", TRIM(var_name_to_check), "' is not double precision."
    END IF

    lstat_check = .TRUE.

END SUBROUTINE example_routine_using_public_vars
```

## Dependencies and Interactions

### Internal Dependencies
-   This file is designed to be `INCLUDE`d within `etsf_io_low_level.f90`. The constants and type definitions it provides become directly available within the `etsf_io_low_level` module.

### External Library Dependencies
-   **NetCDF Library (`netcdf` module)**: Several parameters are initialized using values from the NetCDF library (e.g., `NF90_INT`, `NF90_DOUBLE`, `NF90_CHAR`, `NF90_FLOAT`, `NF90_GLOBAL`). This ensures that the ETSF I/O constants for data types and the global attribute scope are consistent with the underlying NetCDF values.

### Global Variables/Modules Accessed
-   The constants and types defined herein are intended to be publicly accessible within the scope of the `etsf_io_low_level` module after this file is included.
```
